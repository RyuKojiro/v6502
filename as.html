<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>v6502: Assembler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">v6502
   </div>
   <div id="projectbrief">The MOS 6502 Virtual Machine and Toolchain Infrastructure</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Assembler </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ld_usage"></a>
Arguments and Usage</h1>
<p>usage: as6502 [-STWw] [-F <em>format</em>] [<em>file</em> ...]</p>
<p>Any number of files may be specified and they will all be assembled, individually. To create useful binaries, rather than just object files, either specify flat as the format, or link the binaries with the <a class="el" href="ld.html">Linker</a>. If no files are specified, as6502 will assemble from stdin, line-buffered.</p>
<ul>
<li><p class="startli">-F <em>format</em> </p>
<p class="startli">Specify a <em>format</em> to produce as output for linking or execution.</p>
<p class="startli">Supported formats:</p><ul>
<li>flat - Root segment only, no symbol table, single execution unit ready to be loaded into memory for running.</li>
<li>aout - Traditional a.out OMAGIC object file format.</li>
</ul>
</li>
<li><p class="startli">-S</p>
<p class="startli">Dump assembly with binary results and addresses to stdout for verification of what is being produced. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="as.html#debug">Debugging</a></dd></dl>
</li>
<li><p class="startli">-T</p>
<p class="startli">After first pass, dump a human readable representation of the symbol table.</p>
</li>
<li><p class="startli">-w</p>
<p class="startli">Emit warnings where possible, and attempt to recover, then continue assembly.</p>
</li>
<li><p class="startli">-W</p>
<p class="startli">Treat warnings as errors.</p>
</li>
</ul>
<h1><a class="anchor" id="ld_notes"></a>
Notes</h1>
<p>When assembling from stdin, label parsing and dereferencing is not supported. This is because the labels are all determined in advance on a first pass that only cares about instruction size, and then the second pass actually begins converting the assembly to machine code, while dereferencing the labels along the way via the pre-built table.</p>
<h1><a class="anchor" id="design"></a>
Design</h1>
<p>The assembler makes two passes over the source, and aims to be as efficient as possible, while still exposing powerful access to the assembly process.</p>
<ol type="1">
<li>Reference calculation; conversion of variable names and labels to addresses. Preallocation of object blobs based on dot-prefixed directives.</li>
<li>(Only pass when assembling from stdin) Population of dot-prefixed lines (e.g. Filling <b>.data</b> blocks, assigning <b>.word</b> values, etc.) Conversion of instructions to machine code.</li>
</ol>
<h1><a class="anchor" id="debug"></a>
Debugging</h1>
<p>Debug output logging has been added to allow printing of the assembly process, as it happens, the output is column oriented and can be seen below. Comment lines, or lines that contain no code or labels, are not printed. The column headers have been added for clarity, and the middle 170 lines omitted for brevity.</p>
<div class="fragment"><div class="line">Offset  Op Lo Hi   Line  Label / Instruction</div><div class="line">------  -- -- --   ----  -------------------</div><div class="line">0x0000: 20 03 00 -   15:    jsr $0003</div><div class="line">0x0003: 20 38 00 -   16:    jsr $0038</div><div class="line">0x0006:          -   18: init:</div><div class="line">0x0006: 20 04 00 -   19:    jsr $0004</div><div class="line">0x0009: 20 1e 00 -   20:    jsr $001e</div><div class="line">0x000c: 60       -   21:    rts</div><div class="line">    … 170 lines ommitted …</div><div class="line">0x0130: a2 00    -  241:    ldx #0</div><div class="line">0x0132:          -  230: drawSnake:</div><div class="line">0x0132: ea       -  243:    nop</div><div class="line">0x0133: ea       -  244:    nop</div><div class="line">0x0134: ca       -  245:    dex</div><div class="line">0x0135: d0 0c    -  246:    bne $0c</div><div class="line">0x0137: 60       -  247:    rts</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 26 2017 23:57:31 for v6502 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
